<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog 
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="
	http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd
	">

    <changeSet id="createUserTable" author="Iurii Parfeniuk">
        <createTable tableName="c_user">
            <column name="id" type="bigint" autoIncrement="true" >
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="login" type="varchar(255)">
            	<constraints nullable="false" unique="true" uniqueConstraintName="user_login_uk"/>
            </column>
            <column name="password" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="role" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="varchar(255)" />
    		<column name="full_name" type="varchar(255)"/>
    		<column name="image_url" type="varchar(255)"/>
        </createTable>
    </changeSet>
    
    <changeSet id="createPictureTable" author="Oleh Yatskiv">
    	<createTable tableName="picture">
    		<column name="id" type="bigint" autoIncrement="true">
    			<constraints primaryKey="true" nullable="false"/>
    		</column>
    		<column name="name" type="varchar(255)">
    			<constraints nullable="false"/>
    		</column>
    		<column name="url" type="varchar(255)">
    			<constraints nullable="false" unique="true"/>
    		</column>
    	</createTable>
    </changeSet>
    
    <changeSet id="createFunnyPictureTable" author="Oleh Yatskiv">
    	<createTable tableName="funny_picture">
    		<column name="id" type="bigint" autoIncrement="true">
    			<constraints primaryKey="true" nullable="false"/>
    		</column>
    		<column name="name" type="varchar(255)">
    			<constraints nullable="false"/>
    		</column>
    		<column name="url" type="varchar(255)">
    			<constraints nullable="false" unique="true"/>
    		</column>
    		<column name="header" type="varchar(255)">
    		</column>
    		<column name="footer" type="varchar(255)">
    		</column>
    		<column name="picture_id" type="bigint">
            <constraints nullable="false" foreignKeyName="fk_funnypic_picture" references="picture(id)"/>
        	</column>
    		
    	</createTable>
    </changeSet>
    <changeSet id="createContactTable" author="Ivan Ursul">
    	<createTable tableName="feedback">
    		<column name="id" type="bigint" autoIncrement="true">
    			<constraints primaryKey="true" nullable="false"/>
    		</column>
    		<column name="name" type="varchar(255)">
    			<constraints nullable="false"/>
    		</column>
    		<column name="email" type="varchar(255)">
    			<constraints nullable="false"/>
    		</column>
    		<column name="text" type="text"/>
    	</createTable>    
    </changeSet>
    <changeSet id="addSubjectFieldContactTable" author="Ivan Ursul">
    	<addColumn tableName="feedback">
    		<column name="subject" type="varchar(255)"/>
    	</addColumn>
    </changeSet>
	<changeSet id="createThumbnailTable" author="Ivan Ursul">
		<createTable tableName="thumbnail">
			<column name="id" type="bigint" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="url" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="type" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="update_date" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
			<column name="create_date" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>
	<changeSet id="createFunnyPictureThumbnailTable" author="Ivan Ursul">
		<createTable tableName="funny_picture_thumbnail">
			<column name="id" type="bigint" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="thumbnail_id" type="bigint">
				<constraints nullable="false" foreignKeyName="fk_funny_picture_thumbnail_thumbnail" references="thumbnail(id)" />
			</column>
			<column name="funny_picture_id" type="bigint">
				<constraints nullable="false" foreignKeyName="fk_funny_picture_thumbnail" references="funny_picture(id)" />
			</column>
			<column name="update_date" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
			<column name="create_date" type="TIMESTAMP">
				<constraints nullable="false" />
			</column>
		</createTable>
		<addUniqueConstraint columnNames="thumbnail_id, funny_picture_id" tableName="funny_picture_thumbnail" />
	</changeSet>
	<changeSet id="dropThumbnailTable" author="ivanursul">
		<dropColumn tableName="funny_picture_thumbnail" columnName="thumbnail_id"/>
		<dropTable tableName="thumbnail"/>
		
		<addColumn tableName="funny_picture_thumbnail" >
			<column name="url" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="type" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
		</addColumn>
		
	</changeSet>
</databaseChangeLog>
